{% extends "visualizer/base.html" %}
{% load static %}

{% block extra_css %}
<style>
    html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
    }
    
    #map {
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex w-100 h-100">
    
    <!-- Sidebar fixa e ajustada -->
    <div id="sidebar" class="d-flex flex-column bg-light border-end p-3" style="width: 300px; height: 100vh; overflow-y: hidden;">
        
        <!-- Seção 1: Atividade -->
        <div class="flex-shrink-0" style="height: 25vh; overflow-y: auto;">
            <h6 class="text-muted fs-6">
                <i class="ti ti-activity fs-5"></i> Atividade
            </h6>
            <div class="scrollable-section">
                {% for place in activity_data %}
                    <div class="card p-1 mb-1 shadow-sm
                        {% if place.status == 'PM' %} bg-success text-white
                        {% elif place.status == 'MI' %} bg-warning text-dark
                        {% else %} bg-danger text-white {% endif %}">
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0 fs-7">{{ place.name }}</h6>
                            <i class="{{ place.trend_icon }} fs-6"></i>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-muted fs-7">Nenhuma atividade registrada.</p>
                {% endfor %}
            </div>
        </div>

        <hr>

        <!-- Seção 2: Notificações -->
        <div class="flex-shrink-0" style="height: 50vh; overflow-y: auto;">
            <h6 class="text-muted fs-6">
                <i class="ti ti-bell fs-5"></i> Notificações
            </h6>
            <div class="scrollable-section">
                {% for notification in notifications %}
                    <div class="card p-3 mb-3 shadow-sm">
                        <div class="d-flex align-items-center">
                            <i class="ti ti-info-circle fs-6 text-primary"></i>
                            <h6 class="ms-2 mb-0 fs-6">{{ notification.title }}</h6>
                        </div>
                        <p class="mt-1 text-muted fs-6">{{ notification.description }}</p>
                        <div class="d-flex justify-content-end">
                            <a href="#" class="text-decoration-none fs-7">Ver mais</a>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-muted fs-7">Nenhuma notificação disponível.</p>
                {% endfor %}
            </div>
        </div>

        <hr>

        <!-- Seção 3: Locais Salvos -->
        <div class="flex-shrink-0" style="height: 25vh; overflow-y: auto;">
            <h6 class="text-muted fs-6">
                <i class="ti ti-map-pin fs-5"></i> Locais Salvos
            </h6>
            <div class="scrollable-section">
                {% if user_authenticated %}
                    {% if saved_places %}
                        {% for place in activity_data %}
                            {% if place.id in saved_places %}
                                <div class="card p-1 mb-1 border-primary text-primary shadow-sm">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 fs-7">{{ place.name }}</h6>
                                        <i class="{{ place.trend_icon }} fs-6"></i>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <p class="text-muted fs-7">Você ainda não salvou nenhum local.</p>
                    {% endif %}
                {% else %}
                    <div class="text-center p-3">
                        <p class="text-muted fs-7">Entre na sua conta para salvar locais e acompanhar o estado deles.</p>
                        <a href="#" class="btn btn-light fs-7"><i class="ti ti-login-2 fs-6"></i> Entrar / Cadastrar</a>
                    </div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Mapa -->
    <div class="flex-grow-1">
        <div id="map" class="w-100 h-100"></div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
    <script>
        var heatmapData = JSON.parse("{{heatmap_data | escapejs}}");
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places,visualization&callback=initMap" async defer></script>

    <script src="{% static 'visualizer/js/heatmap.js' %}"></script>
{% endblock %}
